<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Workflow demonstration | A Machine Learning Primer for Natural Resource Management</title>
  <meta name="description" content="This primer serves as a succinct guidebook on using machine learning in natural resources management." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Workflow demonstration | A Machine Learning Primer for Natural Resource Management" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This primer serves as a succinct guidebook on using machine learning in natural resources management." />
  <meta name="github-repo" content="nataliegnelson/ml_primer" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Workflow demonstration | A Machine Learning Primer for Natural Resource Management" />
  
  <meta name="twitter:description" content="This primer serves as a succinct guidebook on using machine learning in natural resources management." />
  

<meta name="author" content="Natalie G. Nelson, Shih-Ni Prim, Sheila Saia, Khara Grieger, Anders Huseth" />


<meta name="date" content="2025-04-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="case-studies.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Machine Learning Primer</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#how-to-use-this-primer"><i class="fa fa-check"></i><b>1.1</b> How to use this primer</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#learning-how-to-code"><i class="fa fa-check"></i><b>1.2</b> Learning how to code</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.3</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i><b>1.4</b> Citation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.5</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html"><i class="fa fa-check"></i><b>2</b> What is machine learning?</a></li>
<li class="chapter" data-level="3" data-path="what-is-machine-learning-1.html"><a href="what-is-machine-learning-1.html"><i class="fa fa-check"></i><b>3</b> What is machine learning?</a>
<ul>
<li class="chapter" data-level="3.1" data-path="what-is-machine-learning-1.html"><a href="what-is-machine-learning-1.html#how-is-machine-learning-useful-for-natural-resources-management"><i class="fa fa-check"></i><b>3.1</b> How is machine learning useful for natural resources management?</a></li>
<li class="chapter" data-level="3.2" data-path="what-is-machine-learning-1.html"><a href="what-is-machine-learning-1.html#pros-and-cons"><i class="fa fa-check"></i><b>3.2</b> Pros and cons</a></li>
<li class="chapter" data-level="3.3" data-path="what-is-machine-learning-1.html"><a href="what-is-machine-learning-1.html#classes-of-machine-learning-models"><i class="fa fa-check"></i><b>3.3</b> Classes of machine learning models</a></li>
<li class="chapter" data-level="3.4" data-path="what-is-machine-learning-1.html"><a href="what-is-machine-learning-1.html#an-example-of-supervised-and-unsupervised-learning"><i class="fa fa-check"></i><b>3.4</b> An example of supervised and unsupervised learning</a></li>
<li class="chapter" data-level="3.5" data-path="what-is-machine-learning-1.html"><a href="what-is-machine-learning-1.html#algorithms"><i class="fa fa-check"></i><b>3.5</b> Algorithms</a></li>
<li class="chapter" data-level="3.6" data-path="what-is-machine-learning-1.html"><a href="what-is-machine-learning-1.html#a-deeper-dive"><i class="fa fa-check"></i><b>3.6</b> A deeper dive</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="key-considerations.html"><a href="key-considerations.html"><i class="fa fa-check"></i><b>4</b> Key considerations</a></li>
<li class="chapter" data-level="5" data-path="case-studies.html"><a href="case-studies.html"><i class="fa fa-check"></i><b>5</b> Case studies</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-studies.html"><a href="case-studies.html#daily-pluvial-flood-prediction"><i class="fa fa-check"></i><b>5.1</b> 1: Daily pluvial flood prediction</a></li>
<li class="chapter" data-level="5.2" data-path="case-studies.html"><a href="case-studies.html#fecal-coliform-forecasting"><i class="fa fa-check"></i><b>5.2</b> 2: Fecal coliform forecasting</a></li>
<li class="chapter" data-level="5.3" data-path="case-studies.html"><a href="case-studies.html#in-season-sweetpotato-yield-forecasting"><i class="fa fa-check"></i><b>5.3</b> 3: In-season sweetpotato yield forecasting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>6</b> Workflow demonstration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="workflow.html"><a href="workflow.html#prepare-the-data"><i class="fa fa-check"></i><b>6.1</b> Prepare the data</a></li>
<li class="chapter" data-level="6.2" data-path="workflow.html"><a href="workflow.html#classification-model"><i class="fa fa-check"></i><b>6.2</b> Classification model</a></li>
<li class="chapter" data-level="6.3" data-path="workflow.html"><a href="workflow.html#continuous-model"><i class="fa fa-check"></i><b>6.3</b> Continuous model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Machine Learning Primer for Natural Resource Management</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="workflow" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Workflow demonstration<a href="workflow.html#workflow" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Authors: <a href="https://www.linkedin.com/in/shih-ni-prim-14033336/">Shih-Ni Prim</a></em></p>
<p>In this section, we use a dataset to exemplify a typical workflow for constructing machine learning models. We skip exploratory data analysis, or the process of exploring your data to understand its structure and components, but such exploration should always occur prior to any modeling. For more on exploratory data analysis, refer to <a href="https://bookdown.org/rdpeng/artofdatascience/exploratory-data-analysis.html">Chapter 4 Exploratory Data Analysis</a> in <em>The Art of Data Science</em> by Roger D. Peng and Elizabeth Matsui.</p>
<p>The dataset analyzed here contains wine quality and traits, and our goal is to predict the quality of wine using traits. The dataset can be found <a href="https://www.kaggle.com/datasets/yasserh/wine-quality-dataset">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="workflow.html#cb1-1" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">eval =</span> <span class="cn">TRUE</span>, <span class="at">cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="workflow.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tree)</span>
<span id="cb1-3"><a href="workflow.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="workflow.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-5"><a href="workflow.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(rattle)</span>
<span id="cb1-6"><a href="workflow.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code></pre></div>
<div id="prepare-the-data" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Prepare the data<a href="workflow.html#prepare-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We first read in the data and rename the variables, so coding is easier.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="workflow.html#cb2-1" tabindex="-1"></a>wine <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;materials/winequality-red.csv&quot;</span>, <span class="at">delim =</span> <span class="st">&#39;;&#39;</span>)</span></code></pre></div>
<pre><code>## Rows: 1599 Columns: 12
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;;&quot;
## dbl (12): fixed acidity, volatile acidity, citric acid, residual sugar, chlo...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="workflow.html#cb4-1" tabindex="-1"></a><span class="co"># shorten variable names</span></span>
<span id="cb4-2"><a href="workflow.html#cb4-2" tabindex="-1"></a>fa <span class="ot">&lt;-</span> wine<span class="sc">$</span><span class="st">`</span><span class="at">fixed acidity</span><span class="st">`</span></span>
<span id="cb4-3"><a href="workflow.html#cb4-3" tabindex="-1"></a>va <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(wine<span class="sc">$</span><span class="st">`</span><span class="at">volatile acidity</span><span class="st">`</span>)</span>
<span id="cb4-4"><a href="workflow.html#cb4-4" tabindex="-1"></a>ca <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(wine<span class="sc">$</span><span class="st">`</span><span class="at">citric acid</span><span class="st">`</span>)</span>
<span id="cb4-5"><a href="workflow.html#cb4-5" tabindex="-1"></a>rs <span class="ot">&lt;-</span> wine<span class="sc">$</span><span class="st">`</span><span class="at">residual sugar</span><span class="st">`</span></span>
<span id="cb4-6"><a href="workflow.html#cb4-6" tabindex="-1"></a>ch <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(wine<span class="sc">$</span>chlorides)</span>
<span id="cb4-7"><a href="workflow.html#cb4-7" tabindex="-1"></a>fsd <span class="ot">&lt;-</span> wine<span class="sc">$</span><span class="st">`</span><span class="at">free sulfur dioxide</span><span class="st">`</span></span>
<span id="cb4-8"><a href="workflow.html#cb4-8" tabindex="-1"></a>tsd <span class="ot">&lt;-</span> wine<span class="sc">$</span><span class="st">`</span><span class="at">total sulfur dioxide</span><span class="st">`</span></span>
<span id="cb4-9"><a href="workflow.html#cb4-9" tabindex="-1"></a>den <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(wine<span class="sc">$</span>density)</span>
<span id="cb4-10"><a href="workflow.html#cb4-10" tabindex="-1"></a>ph <span class="ot">&lt;-</span> wine<span class="sc">$</span>pH</span>
<span id="cb4-11"><a href="workflow.html#cb4-11" tabindex="-1"></a>sul <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(wine<span class="sc">$</span>sulphates)</span>
<span id="cb4-12"><a href="workflow.html#cb4-12" tabindex="-1"></a>al <span class="ot">&lt;-</span> wine<span class="sc">$</span>alcohol</span>
<span id="cb4-13"><a href="workflow.html#cb4-13" tabindex="-1"></a>qual <span class="ot">&lt;-</span> wine<span class="sc">$</span>quality</span>
<span id="cb4-14"><a href="workflow.html#cb4-14" tabindex="-1"></a>winez <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(fa, va, ca, rs, ch, fsd, tsd, den, ph, sul, al, qual)</span></code></pre></div>
<p>Here, we’ll develop a Random Forest model, which is the same machine learning algorithm used to develop the models presented in Chapter 4. To demonstrate how to construct a Random Forest model with continuous and discrete outcomes, we also transform the continuous variable, wine quality (our response variable) into two discrete variables. One has two levels (high vs low), and one has three levels (H, M, and L). The thresholds are decided rather arbitrarily, and you can use your domain knowledge to gauge how to set the thresholds.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="workflow.html#cb5-1" tabindex="-1"></a><span class="co"># collapse qual into 2 labels</span></span>
<span id="cb5-2"><a href="workflow.html#cb5-2" tabindex="-1"></a>winez<span class="sc">$</span>qual2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(winez<span class="sc">$</span>qual <span class="sc">&lt;</span> <span class="dv">6</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>))</span>
<span id="cb5-3"><a href="workflow.html#cb5-3" tabindex="-1"></a><span class="co"># collapse qual into 3 labels</span></span>
<span id="cb5-4"><a href="workflow.html#cb5-4" tabindex="-1"></a>winez<span class="sc">$</span>qual3 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(winez<span class="sc">$</span>qual <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="st">&quot;L&quot;</span>, <span class="fu">ifelse</span>(winez<span class="sc">$</span>qual <span class="sc">&lt;</span> <span class="dv">7</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;H&quot;</span>)))</span>
<span id="cb5-5"><a href="workflow.html#cb5-5" tabindex="-1"></a><span class="fu">table</span>(qual)</span></code></pre></div>
<pre><code>## qual
##   3   4   5   6   7   8 
##  10  53 681 638 199  18</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="workflow.html#cb7-1" tabindex="-1"></a><span class="fu">table</span>(winez<span class="sc">$</span>qual2)</span></code></pre></div>
<pre><code>## 
## high  low 
##  855  744</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="workflow.html#cb9-1" tabindex="-1"></a><span class="fu">table</span>(winez<span class="sc">$</span>qual3)</span></code></pre></div>
<pre><code>## 
##    H    L    M 
##  217   63 1319</code></pre>
<p>Next, we randomly separate the dataset into a training set (80% of the rows) and a testing set (20% of the rows). A seed is set so that the result can be reproduced.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="workflow.html#cb11-1" tabindex="-1"></a><span class="co"># separate data into a training set and a test set </span></span>
<span id="cb11-2"><a href="workflow.html#cb11-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb11-3"><a href="workflow.html#cb11-3" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(winez), <span class="fu">nrow</span>(winez)<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb11-4"><a href="workflow.html#cb11-4" tabindex="-1"></a>winez_train <span class="ot">&lt;-</span> winez[train,]</span>
<span id="cb11-5"><a href="workflow.html#cb11-5" tabindex="-1"></a>winez_test <span class="ot">&lt;-</span> winez[<span class="sc">-</span>train,]</span></code></pre></div>
</div>
<div id="classification-model" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Classification model<a href="workflow.html#classification-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now, we will construct a Random Forest model with a two-level response. After the model is run, we calculate the predictions using the <code>predict</code> function. A plot with the most important predictors in the model is provided. We can see that <code>alcohol</code>, <code>sulphates</code>, and <code>volatile acidity</code> are the three most important predictors for the outcome variable. A confusion matrix is created, which shows different metrics such as overall accuracy rate, sensitivity, specificity, etc.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="workflow.html#cb12-1" tabindex="-1"></a><span class="co"># random forest</span></span>
<span id="cb12-2"><a href="workflow.html#cb12-2" tabindex="-1"></a>rfGrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb12-3"><a href="workflow.html#cb12-3" tabindex="-1"></a><span class="co"># 2-level variable</span></span>
<span id="cb12-4"><a href="workflow.html#cb12-4" tabindex="-1"></a>rf_tree2 <span class="ot">&lt;-</span> <span class="fu">train</span>(qual2 <span class="sc">~</span> fa <span class="sc">+</span> va <span class="sc">+</span> ca <span class="sc">+</span> rs <span class="sc">+</span> ch <span class="sc">+</span> fsd <span class="sc">+</span> tsd <span class="sc">+</span> den <span class="sc">+</span> ph <span class="sc">+</span> sul <span class="sc">+</span> al, <span class="at">data =</span> winez_train, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>), <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">10</span>), <span class="at">tuneGrid =</span> rfGrid)</span>
<span id="cb12-5"><a href="workflow.html#cb12-5" tabindex="-1"></a>rf2_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_tree2, <span class="at">newdata =</span> winez_test)</span>
<span id="cb12-6"><a href="workflow.html#cb12-6" tabindex="-1"></a>rfMatrix2 <span class="ot">&lt;-</span> <span class="fu">table</span>(rf2_pred, winez_test<span class="sc">$</span>qual2)</span>
<span id="cb12-7"><a href="workflow.html#cb12-7" tabindex="-1"></a>rf2_test <span class="ot">&lt;-</span> <span class="fu">mean</span>(rf2_pred <span class="sc">==</span> winez_test<span class="sc">$</span>qual2)</span>
<span id="cb12-8"><a href="workflow.html#cb12-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">varImp</span>(rf_tree2))</span></code></pre></div>
<p><img src="ml-primer_files/figure-html/rf-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="workflow.html#cb13-1" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf2_pred, winez_test<span class="sc">$</span>qual2)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction high low
##       high  138  25
##       low    45 112
##                                           
##                Accuracy : 0.7812          
##                  95% CI : (0.7319, 0.8253)
##     No Information Rate : 0.5719          
##     P-Value [Acc &gt; NIR] : 2.968e-15       
##                                           
##                   Kappa : 0.5613          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.02315         
##                                           
##             Sensitivity : 0.7541          
##             Specificity : 0.8175          
##          Pos Pred Value : 0.8466          
##          Neg Pred Value : 0.7134          
##              Prevalence : 0.5719          
##          Detection Rate : 0.4313          
##    Detection Prevalence : 0.5094          
##       Balanced Accuracy : 0.7858          
##                                           
##        &#39;Positive&#39; Class : high            
## </code></pre>
<p>Next, we create a model with the three-level outcome variable. Again, important predictors are plotted and a confusion matrix is included below. <code>alcohol</code>, <code>volatile acidity</code>, and <code>sulphates</code> are again the three most important predictors, but the order changed. The overall accuracy is higher here than the two-level model.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="workflow.html#cb15-1" tabindex="-1"></a><span class="co"># 3-level variable</span></span>
<span id="cb15-2"><a href="workflow.html#cb15-2" tabindex="-1"></a>rf_tree3 <span class="ot">&lt;-</span> <span class="fu">train</span>(qual3 <span class="sc">~</span> fa <span class="sc">+</span> va <span class="sc">+</span> ca <span class="sc">+</span> rs <span class="sc">+</span> ch <span class="sc">+</span> fsd <span class="sc">+</span> tsd <span class="sc">+</span> den <span class="sc">+</span> ph <span class="sc">+</span> sul <span class="sc">+</span> al, <span class="at">data =</span> winez_train, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>), <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">10</span>), <span class="at">tuneGrid =</span> rfGrid)</span>
<span id="cb15-3"><a href="workflow.html#cb15-3" tabindex="-1"></a>rf3_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_tree3, <span class="at">newdata =</span> winez_test)</span>
<span id="cb15-4"><a href="workflow.html#cb15-4" tabindex="-1"></a>rfMatrix3 <span class="ot">&lt;-</span> <span class="fu">table</span>(rf3_pred, winez_test<span class="sc">$</span>qual3)</span>
<span id="cb15-5"><a href="workflow.html#cb15-5" tabindex="-1"></a>rf3_test <span class="ot">&lt;-</span> <span class="fu">mean</span>(rf3_pred <span class="sc">==</span> winez_test<span class="sc">$</span>qual3)</span>
<span id="cb15-6"><a href="workflow.html#cb15-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">varImp</span>(rf_tree3))</span></code></pre></div>
<p><img src="ml-primer_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="workflow.html#cb16-1" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf3_pred, winez_test<span class="sc">$</span>qual3)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   H   L   M
##          H  25   0   5
##          L   0   0   1
##          M  18   8 263
## 
## Overall Statistics
##                                           
##                Accuracy : 0.9             
##                  95% CI : (0.8618, 0.9306)
##     No Information Rate : 0.8406          
##     P-Value [Acc &gt; NIR] : 0.001473        
##                                           
##                   Kappa : 0.5617          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: H Class: L Class: M
## Sensitivity           0.58140 0.000000   0.9777
## Specificity           0.98195 0.996795   0.4902
## Pos Pred Value        0.83333 0.000000   0.9100
## Neg Pred Value        0.93793 0.974922   0.8065
## Prevalence            0.13437 0.025000   0.8406
## Detection Rate        0.07812 0.000000   0.8219
## Detection Prevalence  0.09375 0.003125   0.9031
## Balanced Accuracy     0.78167 0.498397   0.7339</code></pre>
<p>The plot below shows how the accuracy rate changes with the number of randomly selected variables in each tree (denoted as <span class="math inline">\(m\)</span>).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="workflow.html#cb18-1" tabindex="-1"></a><span class="co"># random forest plot: accuracy rates vs number of predictors</span></span>
<span id="cb18-2"><a href="workflow.html#cb18-2" tabindex="-1"></a>rfplot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rf_tree2)</span>
<span id="cb18-3"><a href="workflow.html#cb18-3" tabindex="-1"></a>rfplot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rf_tree3)</span>
<span id="cb18-4"><a href="workflow.html#cb18-4" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(rfplot1, rfplot2, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:rfplots"></span>
<img src="ml-primer_files/figure-html/rfplots-1.png" alt="Accuracy Rates vs Number of Predictors Used for 2-level Variable (left) and 3-level Variable (right)" width="100%" height="100%" />
<p class="caption">
Figure 6.1: Accuracy Rates vs Number of Predictors Used for 2-level Variable (left) and 3-level Variable (right)
</p>
</div>
</div>
<div id="continuous-model" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Continuous model<a href="workflow.html#continuous-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next, we construct a Random Forest models with the continuous outcome variable. We first set <span class="math inline">\(m\)</span> as the square root of the number of predictors, as this is commonly recommended. Confusion matrices cannot be provided for continuous responses, but we can calculate the mean squared error (MSE), find important variables, and show how the error decreases with the number of trees constructed. The three most important variables are again <code>alcohol</code>, <code>sulphates</code>, and <code>volatile acidity</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="workflow.html#cb19-1" tabindex="-1"></a><span class="co"># randomforests, mtry = sqrt(11)</span></span>
<span id="cb19-2"><a href="workflow.html#cb19-2" tabindex="-1"></a>rf.def.Wine <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(qual <span class="sc">~</span> fa <span class="sc">+</span> va <span class="sc">+</span> ca <span class="sc">+</span> rs <span class="sc">+</span> ch <span class="sc">+</span> fsd <span class="sc">+</span> tsd <span class="sc">+</span> den <span class="sc">+</span> ph <span class="sc">+</span> sul <span class="sc">+</span> al, <span class="at">data =</span> winez_train, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-3"><a href="workflow.html#cb19-3" tabindex="-1"></a>yhat.rf.Wine <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf.def.Wine, <span class="at">newdata =</span> winez_test)</span>
<span id="cb19-4"><a href="workflow.html#cb19-4" tabindex="-1"></a>rf.mtry3.testMSE <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat.rf.Wine <span class="sc">-</span> winez_test<span class="sc">$</span>qual)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb19-5"><a href="workflow.html#cb19-5" tabindex="-1"></a><span class="fu">varImp</span>(rf.def.Wine)</span></code></pre></div>
<pre><code>##      Overall
## fa  22.11429
## va  37.04878
## ca  23.74687
## rs  18.55913
## ch  24.96786
## fsd 21.65164
## tsd 32.28444
## den 27.19701
## ph  22.36903
## sul 43.52900
## al  54.53284</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="workflow.html#cb21-1" tabindex="-1"></a><span class="fu">plot</span>(rf.def.Wine)</span></code></pre></div>
<p><img src="ml-primer_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>We try several different values for the number of variables included in each tree. <code>alcohol</code>, <code>sulphates</code>, and <code>volatile acidity</code> remain the three most important predictors. Two plots are provided to show how the error decreases with the number of trees.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="workflow.html#cb22-1" tabindex="-1"></a><span class="co"># mtry = 4</span></span>
<span id="cb22-2"><a href="workflow.html#cb22-2" tabindex="-1"></a>rf.def.Wine.m4 <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(qual <span class="sc">~</span> fa <span class="sc">+</span> va <span class="sc">+</span> ca <span class="sc">+</span> rs <span class="sc">+</span> ch <span class="sc">+</span> fsd <span class="sc">+</span> tsd <span class="sc">+</span> den <span class="sc">+</span> ph <span class="sc">+</span> sul <span class="sc">+</span> al, <span class="at">data =</span> winez_train, <span class="at">mtry =</span> <span class="dv">4</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-3"><a href="workflow.html#cb22-3" tabindex="-1"></a>rf.pred.m4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf.def.Wine.m4, <span class="at">newdata =</span> winez_test)</span>
<span id="cb22-4"><a href="workflow.html#cb22-4" tabindex="-1"></a>rf.mtry4.testMSE <span class="ot">&lt;-</span> <span class="fu">mean</span>((rf.pred.m4 <span class="sc">-</span> winez_test<span class="sc">$</span>qual)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb22-5"><a href="workflow.html#cb22-5" tabindex="-1"></a><span class="fu">varImp</span>(rf.def.Wine.m4)</span></code></pre></div>
<pre><code>##      Overall
## fa  22.78226
## va  39.40868
## ca  22.22551
## rs  16.27685
## ch  25.12775
## fsd 21.58168
## tsd 30.36789
## den 27.20655
## ph  20.22223
## sul 47.59070
## al  60.54909</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="workflow.html#cb24-1" tabindex="-1"></a><span class="co"># mtry = 7</span></span>
<span id="cb24-2"><a href="workflow.html#cb24-2" tabindex="-1"></a>rf.def.Wine.m7 <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(qual <span class="sc">~</span> fa <span class="sc">+</span> va <span class="sc">+</span> ca <span class="sc">+</span> rs <span class="sc">+</span> ch <span class="sc">+</span> fsd <span class="sc">+</span> tsd <span class="sc">+</span> den <span class="sc">+</span> ph <span class="sc">+</span> sul <span class="sc">+</span> al, <span class="at">data =</span> winez_train, <span class="at">mtry =</span> <span class="dv">7</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-3"><a href="workflow.html#cb24-3" tabindex="-1"></a>rf.pred.m7 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf.def.Wine.m7, <span class="at">newdata =</span> winez_test)</span>
<span id="cb24-4"><a href="workflow.html#cb24-4" tabindex="-1"></a>rf.mtry7.testMSE <span class="ot">&lt;-</span> <span class="fu">mean</span>((rf.pred.m7 <span class="sc">-</span> winez_test<span class="sc">$</span>qual)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb24-5"><a href="workflow.html#cb24-5" tabindex="-1"></a><span class="fu">varImp</span>(rf.def.Wine.m7)</span></code></pre></div>
<pre><code>##      Overall
## fa  22.31197
## va  43.85162
## ca  22.34412
## rs  15.79913
## ch  26.89172
## fsd 22.86225
## tsd 35.73985
## den 28.37794
## ph  24.39275
## sul 55.85386
## al  71.99840</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="workflow.html#cb26-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb26-2"><a href="workflow.html#cb26-2" tabindex="-1"></a><span class="fu">plot</span>(rf.def.Wine.m4)</span>
<span id="cb26-3"><a href="workflow.html#cb26-3" tabindex="-1"></a><span class="fu">plot</span>(rf.def.Wine.m7)</span></code></pre></div>
<p><img src="ml-primer_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Lastly, we put the MSEs from these models together. The differences are very small, but the model that uses <span class="math inline">\(m=\sqrt{p}\)</span> has a slightly lower MSE.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="workflow.html#cb27-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rf.mtry3.testMSE, rf.mtry4.testMSE, rf.mtry7.testMSE)</span>
<span id="cb27-2"><a href="workflow.html#cb27-2" tabindex="-1"></a><span class="fu">colnames</span>(res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;squre root of p&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;7&quot;</span>)</span>
<span id="cb27-3"><a href="workflow.html#cb27-3" tabindex="-1"></a><span class="fu">rownames</span>(res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MSE&quot;</span>)</span>
<span id="cb27-4"><a href="workflow.html#cb27-4" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">squre root of p</th>
<th align="right">4</th>
<th align="right">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">MSE</td>
<td align="right">0.289515</td>
<td align="right">0.2907887</td>
<td align="right">0.292777</td>
</tr>
</tbody>
</table>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case-studies.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-workflowdemo.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ml-primer.pdf", "ml-primer.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
